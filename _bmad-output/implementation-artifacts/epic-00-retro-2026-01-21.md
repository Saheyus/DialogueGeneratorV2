# R√©trospective Epic 0: Infrastructure & Setup (Brownfield Adjustments)

**Date :** 2026-01-21  
**Facilitateur :** Bob (Scrum Master)  
**Participants :** Marc (Project Lead), Charlie (Senior Dev), Dana (QA Engineer), Alice (Product Owner)  
**Dur√©e du sprint :** 6 jours calendaires (15-21 janvier 2026), dur√©e effective < 6 jours (distractions non-dev)

---

## üìä R√©sum√© Ex√©cutif

### M√©triques de Livraison

- **Stories compl√©t√©es :** 12/12 stories (100%)
- **Dur√©e :** 6 jours calendaires (15-21 janvier 2026)
- **Velocity :** ~2 stories/jour (dur√©e effective < 6 jours)
- **Stories post-planning :** 2 stories critiques ajout√©es (0.5.5, 0.10)

### Qualit√© et Technique

- **Blocages rencontr√©s :** 0 blocages majeurs
- **Technical debt items :** 3 items identifi√©s (tests E2E, duplication code, helper manquants)
- **Test coverage :** >80% pour code critique (unit + integration)
- **Incidents production :** 0 incidents

### R√©sultats Business

- **Objectifs atteints :** 12/12 stories compl√©t√©es
- **Crit√®res de succ√®s :** ‚úÖ Base technique fiable √©tablie
- **Feedback utilisateur :** Stories 0.5.5 et 0.10 identifi√©es comme critiques post-planning

---

## üéØ Ce Qui S'est Bien Pass√©

### 1. Patterns de R√©utilisation Excellents

**Pattern identifi√© :** 8/12 stories ont √©tendu l'existant plut√¥t que cr√©er de nouveaux fichiers

**Exemples concrets :**
- **Story 0.2** : Extension `generationStore.ts` (pas de nouveau store)
- **Story 0.3** : Extension `llm_factory.py` (pas de nouveau factory)
- **Story 0.4** : R√©utilisation `generationStore.sceneSelection` (pas de duplication)
- **Story 0.5.5** : Extension `generateFromNode` (pas de nouveau endpoint)

**Impact :** Coh√©rence architecturale maintenue, moins de code √† maintenir, patterns √©tablis r√©utilisables

### 2. Code Reviews Syst√©matiques et Efficaces

**Pattern identifi√© :** Toutes les stories ont b√©n√©fici√© de code reviews avec corrections HIGH/MEDIUM/LOW

**Exemples concrets :**
- **Story 0.6** : 9 corrections appliqu√©es (CRITICAL, HIGH, MEDIUM)
- **Story 0.7** : 6 corrections appliqu√©es (HIGH, MEDIUM)
- **Story 0.8** : 10+ corrections appliqu√©es (HIGH, MEDIUM, LOW)
- **Story 0.10** : Corrections post-review avec normalisation d√©fensive

**Impact :** Qualit√© de code √©lev√©e, normalisation syst√©matique, gestion d'erreurs robuste

### 3. Documentation Technique Cr√©√©e pour Features Complexes

**Pattern identifi√© :** Documentation cr√©√©e pour features complexes n√©cessitant clarification

**Exemples concrets :**
- **Story 0.10** : `docs/specifications/Unity_Dialogue_Format_4_Test_Results.md` (documentation compl√®te format Unity)
- **Story 0.4** : Documentation patterns preset dans Dev Notes
- **Story 0.5.5** : Documentation architecture dans `GraphView.tsx` et `graphStore.ts`

**Impact :** R√©f√©rence claire pour futures impl√©mentations, r√©duction ambigu√Øt√©s

### 4. Tests Complets Cr√©√©s pour Chaque Story

**Pattern identifi√© :** Toutes les stories ont cr√©√© des tests unitaires + int√©gration + E2E (quand applicable)

**Exemples concrets :**
- **Story 0.2** : 9 tests unitaires modal + 10 tests store + 8 tests hook + 6 tests int√©gration + 6 tests E2E
- **Story 0.3** : 33 tests backend + 20 tests frontend + 7 tests E2E
- **Story 0.7** : 23 tests backend (unitaires + int√©gration)
- **Story 0.10** : 43 tests (unitaires + int√©gration + E2E)

**Impact :** Couverture √©lev√©e, confiance dans les changements, r√©gression d√©tect√©e rapidement

### 5. Breakthrough Moments - Patterns √âtablis

**Story 0.5.5** : Pattern de g√©n√©ration next node avec gestion automatique des connexions
- **Impact :** R√©utilis√© dans plusieurs stories suivantes
- **Pattern :** Backend retourne `suggested_connections` avec `auto_apply: true`

**Story 0.2** : Pattern SSE streaming √©tabli
- **Impact :** R√©utilis√© dans toutes les g√©n√©rations suivantes
- **Pattern :** Format SSE strict `data: {...}\n\n`

**Story 0.3** : Abstraction multi-provider LLM
- **Impact :** Permet extension facile vers nouveaux providers (OpenRouter mentionn√©)
- **Pattern :** Interface `ILLMClient` + Factory pattern

---

## ‚ö†Ô∏è Ce Qui N'a Pas Bien Fonctionn√©

### 1. Tests E2E UI - Helper Manquant pour Charger Dialogue dans √âditeur

**Probl√®me identifi√© :** 4 stories ont des tests E2E UI skip (0.6, 0.9, 0.10, 0.11)

**Cause racine :** Les tests UI n√©cessitent qu'un dialogue soit charg√© dans l'√©diteur de graphe, mais il n'y a pas de helper E2E pour cr√©er/charger un dialogue via l'API backend et l'afficher dans le frontend. Les tests E2E API fonctionnent (backend + frontend + JSON conforme), mais les tests UI n√©cessitent un dialogue charg√© dans l'√©diteur.

**Clarification :** Un test E2E est valide s'il simule le backend, le frontend et produit un dialogue .json conforme au sch√©ma. Unity est hors scope. Les tests skip sont des tests UI sp√©cifiques n√©cessitant un dialogue charg√© dans l'√©diteur.

**Impact :** Couverture E2E UI partielle, tests UI non valid√©s automatiquement

**Action item :** Cr√©er helper E2E pour cr√©er/charger un dialogue via l'API (`POST /api/v1/dialogues/generate/unity-dialogue` ou `POST /api/v1/dialogues/unity/export`) et le charger dans l'√©diteur de graphe

**Exemple de helper n√©cessaire :**
```typescript
// Helper √† cr√©er dans e2e/helpers/unity-dialogues.ts
export async function createAndLoadDialogueInEditor(page: Page, dialogueData: UnityDialogueNode[]) {
  // 1. Cr√©er dialogue via API POST /api/v1/dialogues/generate/unity-dialogue
  // 2. Exporter dialogue via API POST /api/v1/dialogues/unity/export
  // 3. Naviguer vers l'onglet Dialogues dans le frontend
  // 4. Cliquer sur le dialogue cr√©√©
  // 5. Attendre que le graphe soit charg√© dans l'√©diteur
  // 6. V√©rifier que les n≈ìuds sont visibles
}
```

### 2. Duplication Code - Refactorings Post-Review

**Probl√®me identifi√© :** Plusieurs stories ont n√©cessit√© refactoring post-review pour √©liminer duplication

**Exemples concrets :**
- **Story 0.8** : Duplication fermeture EventSource ‚Üí fonction helper `closeEventSource()`
- **Story 0.6** : Duplication code calcul dur√©e ‚Üí fonction helper `_calculate_duration()`
- **Story 0.7** : Duplication code calcul dur√©e ‚Üí fonction helper (3 endroits)

**Impact :** Code review rallong√©, maintenance plus difficile, risque d'incoh√©rences

**Action item :** √ätre plus vigilant sur la duplication lors des reviews, extraire helpers d√®s la premi√®re duplication d√©tect√©e

### 3. Stories Post-Planning - Besoins Critiques Non D√©tect√©s

**Probl√®me identifi√© :** 2 stories critiques cr√©√©es post-planning (0.5.5, 0.10)

**Cause racine :** Besoins r√©els et critiques non cern√©s lors du planning initial

**Impact :** Planning initial incomplet, stories ajout√©es en cours de sprint

**Action item :** Am√©liorer la d√©tection des besoins critiques au prochain planning (spike stories, user interviews, validation avec utilisateurs)

**Stories post-planning :**
- **Story 0.5.5** : G√©n√©ration next node avec gestion automatique des connexions (demande critique de Marc)
- **Story 0.10** : Tests avec 4 r√©sultats (√©chec critique, √©chec, r√©ussite, r√©ussite critique) (demande critique de Marc)

### 4. Gestion Erreurs Datetime - Plusieurs Corrections N√©cessaires

**Probl√®me identifi√© :** Story 0.8 a n√©cessit√© plusieurs corrections pour gestion erreurs `datetime.fromisoformat()`

**Cause racine :** `datetime.fromisoformat()` peut √©chouer avec formats vari√©s, pas de fallback initial

**Impact :** Code review rallong√©, corrections multiples n√©cessaires

**Action item :** Cr√©er helper utilitaire `safe_parse_datetime()` avec fallback pour tous les usages futurs

### 5. Gestion UX/UI - Ajustements Fin de Sprint et Proc√©dure BMAD Partielle

**Probl√®me identifi√© :** Beaucoup d'ajustements d'interface finalis√©s en fin de sprint (Stories 0.11, 0.12). Proc√©dure BMAD de cr√©ation d'interface lanc√©e en cours de sprint mais centr√©e uniquement sur le graphe, n'a pas tout explor√©.

**Contexte :**
- **15 wireframes Excalidraw cr√©√©s** (principalement centr√©s sur l'√©diteur de graphe)
- **Stories UI en fin de sprint :** 0.11 (Header refactoring), 0.12 (Generation Panel harmonisation)
- **Proc√©dure BMAD :** `create-excalidraw-wireframe` utilis√©e mais scope limit√© au graphe
- **Complexit√© UI :** Beaucoup d'UI existante, beaucoup d'info, beaucoup √† ajouter

**Impact :** 
- Ajustements UI concentr√©s en fin de sprint (risque de rush)
- Proc√©dure BMAD n'a pas explor√© toutes les zones UI (g√©n√©ration, contexte, presets, etc.)
- Manque de vision globale de l'interface avant impl√©mentation

**Action item :** Am√©liorer la gestion UX/UI pour les prochains sprints :
1. **Spike UX en d√©but de sprint** : Identifier toutes les zones UI √† modifier/cr√©er
2. **Proc√©dure BMAD compl√®te** : Utiliser `create-excalidraw-wireframe` pour explorer TOUTES les zones UI (pas seulement le graphe)
3. **Wireframes avant impl√©mentation** : Cr√©er wireframes pour toutes les zones UI avant de commencer les stories
4. **Documentation UI centralis√©e** : Maintenir une documentation UI centralis√©e (`docs/ui/`) avec wireframes et d√©cisions UX

---

## üìà Patterns de Velocity

### Temps de Compl√©tion par Type de Story

**Stories infrastructure (0.1-0.4) :** Complexit√© moyenne, quelques corrections post-review
- Story 0.1 : ~1 jour (ready-for-dev, impl√©mentation rapide)
- Story 0.2 : ~1 jour (impl√©mentation + fixes post-impl√©mentation)
- Story 0.3 : ~1 jour (impl√©mentation + fixes E2E validation)
- Story 0.4 : ~1 jour (impl√©mentation + fixes validation)

**Stories validation/governance (0.6-0.8) :** Complexit√© √©lev√©e, plusieurs it√©rations de review
- Story 0.6 : ~1 jour (impl√©mentation + 9 corrections review)
- Story 0.7 : ~1 jour (impl√©mentation + 6 corrections review)
- Story 0.8 : ~1 jour (impl√©mentation + 10+ corrections review)

**Stories UI (0.11-0.12) :** Complexit√© faible, impl√©mentation rapide, mais concentr√©es en fin de sprint
- Story 0.11 : ~0.5 jour (refactorisation UI - Header, consolidation actions)
- Story 0.12 : ~0.5 jour (harmonisation UI - Generation Panel, sliders, tooltips)
- **Note :** Ajustements UI concentr√©s en fin de sprint, proc√©dure BMAD partielle (graphe uniquement)

**Stories post-planning (0.5.5, 0.10) :** Complexit√© √©lev√©e, impl√©mentation compl√®te
- Story 0.5.5 : ~1 jour (g√©n√©ration next node avec connexions automatiques)
- Story 0.10 : ~1 jour (4 r√©sultats de test avec TestNode)

### Tendances Identifi√©es

- **Stories infrastructure :** Velocity constante, peu de surprises
- **Stories validation/governance :** Velocity plus lente due aux it√©rations de review
- **Stories UI :** Velocity rapide, peu de corrections n√©cessaires
- **Stories post-planning :** Velocity normale malgr√© ajout en cours de sprint

---

## üîÑ Collaboration d'√âquipe

### Points Forts

- **Code reviews syst√©matiques :** Toutes les stories ont b√©n√©fici√© de reviews approfondies
- **Documentation technique :** Documentation cr√©√©e pour features complexes
- **Tests complets :** Tests cr√©√©s pour chaque story (unit + integration + E2E)
- **Communication :** Feedback clair et actionnable dans les reviews

### Points d'Am√©lioration

- **D√©tection besoins critiques :** Am√©liorer la d√©tection des besoins r√©els au planning
- **Duplication code :** √ätre plus vigilant sur la duplication lors des reviews
- **Tests E2E :** Cr√©er helpers pour charger donn√©es Unity dans tests E2E

---

## üéì Le√ßons Apprises

### 1. R√©utilisation vs Cr√©ation - Pattern Gagnant

**Le√ßon :** √âtendre l'existant plut√¥t que cr√©er de nouveaux fichiers am√©liore la coh√©rence architecturale

**Application future :** Toujours v√©rifier l'existant avant de cr√©er, documenter la d√©cision (r√©utiliser vs cr√©er)

### 2. Code Reviews Syst√©matiques - Qualit√© √âlev√©e

**Le√ßon :** Code reviews syst√©matiques avec corrections HIGH/MEDIUM/LOW am√©liorent significativement la qualit√©

**Application future :** Maintenir le processus de review, prioriser corrections HIGH/MEDIUM

### 3. Documentation Technique - R√©duction Ambigu√Øt√©s

**Le√ßon :** Documentation cr√©√©e pour features complexes r√©duit les ambigu√Øt√©s et am√©liore la maintenabilit√©

**Application future :** Cr√©er documentation pour features complexes (>100 lignes, logique m√©tier complexe)

### 4. Tests E2E - Helpers Manquants

**Le√ßon :** Tests E2E n√©cessitent helpers pour charger donn√©es Unity, sinon tests skip

**Application future :** Cr√©er helpers E2E r√©utilisables pour charger donn√©es Unity, personnages, lieux

### 5. Stories Post-Planning - Besoins Critiques

**Le√ßon :** Besoins r√©els et critiques peuvent ne pas √™tre d√©tect√©s lors du planning initial

**Application future :** Am√©liorer la d√©tection des besoins critiques (spike stories, user interviews, validation)

### 6. Gestion UX/UI - Spike UX et Wireframes Complets

**Le√ßon :** Avec beaucoup d'UI existante, beaucoup d'info et beaucoup √† ajouter, il faut une vision globale avant impl√©mentation. La proc√©dure BMAD doit explorer TOUTES les zones UI, pas seulement une zone sp√©cifique (ex: graphe).

**Application future :** 
- Spike UX en d√©but de sprint pour identifier toutes les zones UI
- Proc√©dure BMAD compl√®te pour toutes les zones UI (g√©n√©ration, contexte, presets, graphe, etc.)
- Wireframes avant impl√©mentation pour √©viter ajustements en fin de sprint
- Documentation UI centralis√©e (`docs/ui/`) avec wireframes et d√©cisions UX

---

## üöß Technical Debt

### Items Identifi√©s

1. **Tests E2E UI - Helper Manquant (PRIORIT√â HAUTE)**
   - **Description :** Helper E2E manquant pour cr√©er/charger un dialogue via l'API et l'afficher dans l'√©diteur de graphe
   - **Impact :** Couverture E2E UI partielle, tests UI non valid√©s automatiquement
   - **Effort estim√© :** 2-4 heures
   - **Action item :** Cr√©er `e2e/helpers/unity-dialogues.ts` avec fonction `createAndLoadDialogueInEditor()` qui cr√©e un dialogue via l'API backend et le charge dans le frontend

2. **Duplication Code - Helpers Manquants (PRIORIT√â MOYENNE)**
   - **Description :** Plusieurs helpers manquants (fermeture EventSource, calcul dur√©e, etc.)
   - **Impact :** Code review rallong√©, maintenance plus difficile
   - **Effort estim√© :** 1-2 heures
   - **Action item :** Extraire helpers d√®s la premi√®re duplication d√©tect√©e

3. **Gestion Erreurs Datetime - Helper Manquant (PRIORIT√â BASSE)**
   - **Description :** Helper utilitaire `safe_parse_datetime()` manquant
   - **Impact :** Gestion erreurs datetime incoh√©rente
   - **Effort estim√© :** 1 heure
   - **Action item :** Cr√©er `utils/datetime_helpers.py` avec `safe_parse_datetime()`

4. **Gestion UX/UI - Proc√©dure BMAD Partielle (PRIORIT√â MOYENNE)**
   - **Description :** Proc√©dure BMAD `create-excalidraw-wireframe` utilis√©e mais scope limit√© au graphe, n'a pas explor√© toutes les zones UI
   - **Impact :** Ajustements UI concentr√©s en fin de sprint, manque de vision globale
   - **Effort estim√© :** 2-4 heures (spike UX + wireframes complets)
   - **Action item :** Am√©liorer processus UX/UI : spike UX en d√©but de sprint, proc√©dure BMAD compl√®te pour toutes les zones UI, wireframes avant impl√©mentation

---

## üìã Action Items pour Epic 1

### Priorit√© HAUTE

1. **Cr√©er helper E2E pour cr√©er/charger dialogue dans √©diteur**
   - **Responsable :** Dev team
   - **Deadline :** Avant d√©but Epic 1
   - **Description :** Cr√©er `e2e/helpers/unity-dialogues.ts` avec fonction `createAndLoadDialogueInEditor(page, dialogueData)` qui cr√©e un dialogue via l'API backend (`POST /api/v1/dialogues/generate/unity-dialogue` ou `POST /api/v1/dialogues/unity/export`) et le charge dans l'√©diteur de graphe frontend
   - **Crit√®res de succ√®s :** Tests E2E UI peuvent cr√©er/charger automatiquement dialogues dans l'√©diteur (backend + frontend + JSON conforme, Unity hors scope)

2. **Am√©liorer d√©tection besoins critiques au planning**
   - **Responsable :** Scrum Master + Product Owner
   - **Deadline :** Planning Epic 1
   - **Description :** Ajouter spike stories, user interviews, validation avec utilisateurs
   - **Crit√®res de succ√®s :** Moins de stories post-planning, besoins critiques d√©tect√©s en amont

3. **Am√©liorer gestion UX/UI - Spike UX et Wireframes Complets**
   - **Responsable :** Product Owner + Dev team
   - **Deadline :** D√©but Epic 1 (spike UX avant stories UI)
   - **Description :** 
     - **Spike UX en d√©but de sprint** : Identifier toutes les zones UI √† modifier/cr√©er (g√©n√©ration, contexte, presets, graphe, etc.)
     - **Proc√©dure BMAD compl√®te** : Utiliser `create-excalidraw-wireframe` pour explorer TOUTES les zones UI (pas seulement le graphe)
     - **Wireframes avant impl√©mentation** : Cr√©er wireframes pour toutes les zones UI avant de commencer les stories
     - **Documentation UI centralis√©e** : Cr√©er `docs/ui/` avec wireframes et d√©cisions UX
   - **Crit√®res de succ√®s :** Wireframes complets pour toutes les zones UI avant impl√©mentation, moins d'ajustements UI en fin de sprint

### Priorit√© MOYENNE

4. **Extraire helpers d√®s duplication d√©tect√©e**
   - **Responsable :** Dev team
   - **Deadline :** En continu
   - **Description :** √ätre plus vigilant sur la duplication lors des reviews, extraire helpers imm√©diatement
   - **Crit√®res de succ√®s :** Moins de refactorings post-review pour duplication

5. **Cr√©er helper utilitaire datetime**
   - **Responsable :** Dev team
   - **Deadline :** Avant Epic 1 Story 1.1
   - **Description :** Cr√©er `utils/datetime_helpers.py` avec `safe_parse_datetime()`
   - **Crit√®res de succ√®s :** Tous les usages `datetime.fromisoformat()` utilisent le helper

### Priorit√© BASSE

6. **Documenter patterns E2E helpers**
   - **Responsable :** Dev team
   - **Deadline :** Apr√®s cr√©ation helpers
   - **Description :** Documenter dans `docs/testing/e2e-helpers.md`
   - **Crit√®res de succ√®s :** Documentation compl√®te des helpers E2E disponibles

---

## üéØ Pr√©paration Epic 1

### D√©pendances Epic 0 ‚Üí Epic 1

**Epic 1 d√©pend de :**
- ‚úÖ Story 0.1 : Graph Editor stableID (base technique graphe)
- ‚úÖ Story 0.2 : Progress Modal SSE (feedback g√©n√©ration)
- ‚úÖ Story 0.3 : Multi-Provider LLM (g√©n√©ration dialogues)
- ‚úÖ Story 0.4 : Presets syst√®me (r√©duction friction)
- ‚úÖ Story 0.5 : Auto-save (robustesse)
- ‚úÖ Story 0.6 : Validation cycles (validation structurelle)
- ‚úÖ Story 0.7 : Cost governance (protection financi√®re)
- ‚úÖ Story 0.8 : Streaming cleanup (robustesse)
- ‚úÖ Story 0.9 : Preset validation (robustesse presets)
- ‚úÖ Story 0.5.5 : G√©n√©ration next node (g√©n√©ration dialogues)
- ‚úÖ Story 0.10 : Tests 4 r√©sultats (format Unity)

**Toutes les d√©pendances sont compl√©t√©es ‚úÖ**

### Pr√©paration Technique N√©cessaire

1. **Helper E2E Unity dialogues** (action item #1)
2. **Helper datetime** (action item #4)
3. **Documentation patterns E2E** (action item #5)

### Gaps Identifi√©s

- **Aucun gap technique majeur identifi√©**
- **Helper E2E Unity dialogues** : Am√©lioration souhaitable mais pas bloquant

---

## ‚úÖ Engagement √âquipe

### Commitments pour Epic 1

1. **Marc (Project Lead) :** Valider besoins critiques au planning Epic 1 + Faciliter spike UX en d√©but de sprint
2. **Dev team :** Cr√©er helpers E2E et datetime avant d√©but Epic 1 + Participer √† spike UX et cr√©ation wireframes
3. **Scrum Master :** Faciliter d√©tection besoins critiques au planning + Organiser spike UX en d√©but de sprint
4. **QA Engineer :** Utiliser helpers E2E pour compl√©ter tests skip
5. **Product Owner :** Identifier toutes les zones UI √† modifier/cr√©er dans spike UX + Valider wireframes avant impl√©mentation

---

## üìù Notes Finales

**Bob (Scrum Master) :** "Epic 0 est un succ√®s. 12/12 stories compl√©t√©es, base technique solide √©tablie. Les patterns de r√©utilisation et les code reviews syst√©matiques ont √©t√© des atouts majeurs. Les action items identifi√©s sont clairs et actionnables pour Epic 1."

**Marc (Project Lead) :** "Le sprint s'est bien pass√© malgr√© les distractions. Les stories 0.5.5 et 0.10 post-planning √©taient critiques et ont √©t√© livr√©es. Je reprends le travail la semaine prochaine, donc le rythme ralentira."

**Charlie (Senior Dev) :** "La qualit√© du code est √©lev√©e gr√¢ce aux reviews syst√©matiques. Les patterns √©tablis (SSE streaming, multi-provider LLM, g√©n√©ration next node) seront r√©utilisables pour Epic 1."

**Dana (QA Engineer) :** "Les tests E2E API sont complets (backend + frontend + JSON conforme), mais les helpers E2E UI manquants limitent la couverture E2E UI. Les tests skip n√©cessitent un dialogue charg√© dans l'√©diteur. L'action item #1 est prioritaire pour compl√©ter les tests UI."

**Marc (Project Lead) :** "Point important sur la gestion UX/UI : beaucoup d'ajustements en fin de sprint, et la proc√©dure BMAD n'a explor√© que le graphe. Avec beaucoup d'UI existante, beaucoup d'info et beaucoup √† ajouter, il faut am√©liorer le processus pour les prochains sprints. L'action item #3 (spike UX + wireframes complets) est critique."

---

**R√©trospective compl√©t√©e le :** 2026-01-21  
**Prochaine r√©trospective :** Apr√®s Epic 1
